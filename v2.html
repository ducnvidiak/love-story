<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Heart of Thủ Khoa Lý</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background: #000510;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <script>
      /* ================= BASIC SETUP ================= */
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resize);
      resize();

      const PI = Math.PI;

      /* ================= HEART FORMULA ================= */
      function heartPoint(t) {
        return {
          x: 16 * Math.pow(Math.sin(t), 3),
          y:
            13 * Math.cos(t) -
            5 * Math.cos(2 * t) -
            2 * Math.cos(3 * t) -
            Math.cos(4 * t),
        };
      }

      /* ================= PARTICLES ================= */
      const particles = [];
      const TARGET = 2600;

      function getHeartPosition(t, depth) {
        const base = heartPoint(t);
        const r = (1 - depth) * 12;
        return { x: base.x * r, y: base.y * r };
      }

      while (particles.length < TARGET) {
        const t = Math.random() * 2 * PI;
        const depth = Math.pow(Math.random(), 1.5);
        const pos = getHeartPosition(t, depth);

        const isTopGroove = pos.y > 8 && Math.abs(pos.x) < 5;
        const isBottomIntersection = pos.y < -8 && Math.abs(pos.x) < 6;
        const isCenterLine = Math.abs(pos.x) < 0.5;

        let prob = Math.exp(-2.6 * depth);

        if (isTopGroove) {
          prob *= 0.25;
        } else if (isBottomIntersection) {
          prob *= 0.35;
        } else if (isCenterLine) {
          prob *= 0.4;
        }

        if (Math.random() > prob) continue;

        const horizontalJitter = (Math.random() - 0.5) * 0.25;

        particles.push({
          t,
          depth,
          size: 1.0,
          alpha: 0.3 + (1 - depth) * 0.6,
          jitterX: horizontalJitter,
          jitterY: (Math.random() - 0.5) * 0.12,
        });
      }

      /* ================= VŨ TRỤ - STARS ================= */
      const stars = [];
      // Tạo nhiều ngôi sao hơn với độ sáng khác nhau
      for (let i = 0; i < 800; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          r: Math.random() * 1.8,
          brightness: 0.3 + Math.random() * 0.7,
          twinkleSpeed: 0.02 + Math.random() * 0.03,
          twinkleOffset: Math.random() * PI * 2,
        });
      }

      /* ================= DẢI NGÂN HÀ ================= */
      const galaxyParticles = [];
      for (let i = 0; i < 1500; i++) {
        // Tạo dải chéo qua màn hình
        const t = Math.random();
        const centerX = canvas.width * t;
        const centerY = canvas.height * (0.3 + t * 0.4);

        // Phân bố theo gaussian quanh trục dải
        const spread = 80 + Math.random() * 120;
        const angle = Math.random() * PI * 2;

        galaxyParticles.push({
          x: centerX + Math.cos(angle) * spread * (Math.random() * 0.7),
          y: centerY + Math.sin(angle) * spread * (Math.random() * 0.3),
          r: Math.random() * 0.8,
          alpha: 0.1 + Math.random() * 0.3,
          color: Math.random() > 0.7 ? [180, 150, 255] : [200, 200, 255],
        });
      }

      /* ================= HÀNH TINH ================= */
      const planets = [
        {
          x: canvas.width * 0.15,
          y: canvas.height * 0.25,
          r: 35,
          color: [255, 180, 120],
          ringColor: [200, 150, 100],
          hasRing: true,
        },
        {
          x: canvas.width * 0.85,
          y: canvas.height * 0.7,
          r: 28,
          color: [120, 150, 255],
          hasRing: false,
        },
        {
          x: canvas.width * 0.08,
          y: canvas.height * 0.65,
          r: 18,
          color: [255, 100, 100],
          hasRing: false,
        },
      ];

      /* ================= SAO BĂNG ================= */
      const shootingStars = [];

      function createShootingStar() {
        if (Math.random() > 0.98) {
          // 2% mỗi frame
          shootingStars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height * 0.5,
            length: 60 + Math.random() * 80,
            speed: 8 + Math.random() * 6,
            angle: PI / 6 + (Math.random() * PI) / 6,
            life: 1.0,
          });
        }
      }

      /* ================= ROMANTIC HEARTBEAT ================= */
      function romanticHeartbeat(t) {
        const mainBeat = Math.sin(t * 3.2);
        const flutter = Math.sin(t * 6.4) * 0.3;
        const tremor = Math.sin(t * 1.6) * 0.15;
        const combined = (mainBeat + flutter + tremor + 1.5) / 3;
        return Math.pow(combined, 1.3) * 0.85;
      }

      /* ================= ANIMATION ================= */
      let time = 0;

      function drawGalaxy() {
        galaxyParticles.forEach((p) => {
          ctx.fillStyle = `rgba(${p.color[0]}, ${p.color[1]}, ${p.color[2]}, ${p.alpha})`;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, 2 * PI);
          ctx.fill();
        });
      }

      function drawStars() {
        stars.forEach((s) => {
          // Hiệu ứng lấp lánh
          const twinkle =
            Math.sin(time * s.twinkleSpeed + s.twinkleOffset) * 0.3 + 0.7;
          const brightness = s.brightness * twinkle;

          ctx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, 2 * PI);
          ctx.fill();
        });
      }

      function drawPlanets() {
        planets.forEach((p) => {
          // Bóng đổ
          const gradient = ctx.createRadialGradient(
            p.x - p.r * 0.3,
            p.y - p.r * 0.3,
            p.r * 0.1,
            p.x,
            p.y,
            p.r,
          );
          gradient.addColorStop(
            0,
            `rgba(${p.color[0]}, ${p.color[1]}, ${p.color[2]}, 1)`,
          );
          gradient.addColorStop(
            0.7,
            `rgba(${p.color[0] * 0.6}, ${p.color[1] * 0.6}, ${p.color[2] * 0.6}, 1)`,
          );
          gradient.addColorStop(
            1,
            `rgba(${p.color[0] * 0.3}, ${p.color[1] * 0.3}, ${p.color[2] * 0.3}, 1)`,
          );

          ctx.fillStyle = gradient;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, 2 * PI);
          ctx.fill();

          // Vành đai nếu có
          if (p.hasRing) {
            ctx.strokeStyle = `rgba(${p.ringColor[0]}, ${p.ringColor[1]}, ${p.ringColor[2]}, 0.6)`;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.r * 1.6, p.r * 0.4, 0, 0, 2 * PI);
            ctx.stroke();

            ctx.lineWidth = 2;
            ctx.strokeStyle = `rgba(${p.ringColor[0]}, ${p.ringColor[1]}, ${p.ringColor[2]}, 0.3)`;
            ctx.beginPath();
            ctx.ellipse(p.x, p.y, p.r * 1.8, p.r * 0.5, 0, 0, 2 * PI);
            ctx.stroke();
          }
        });
      }

      function drawShootingStars() {
        createShootingStar();

        for (let i = shootingStars.length - 1; i >= 0; i--) {
          const s = shootingStars[i];

          // Di chuyển
          s.x += Math.cos(s.angle) * s.speed;
          s.y += Math.sin(s.angle) * s.speed;
          s.life -= 0.015;

          if (s.life <= 0) {
            shootingStars.splice(i, 1);
            continue;
          }

          // Vẽ đuôi sao băng
          const gradient = ctx.createLinearGradient(
            s.x,
            s.y,
            s.x - Math.cos(s.angle) * s.length,
            s.y - Math.sin(s.angle) * s.length,
          );
          gradient.addColorStop(0, `rgba(255, 255, 255, ${s.life * 0.9})`);
          gradient.addColorStop(0.5, `rgba(200, 220, 255, ${s.life * 0.5})`);
          gradient.addColorStop(1, "rgba(150, 180, 255, 0)");

          ctx.strokeStyle = gradient;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(s.x, s.y);
          ctx.lineTo(
            s.x - Math.cos(s.angle) * s.length * s.life,
            s.y - Math.sin(s.angle) * s.length * s.life,
          );
          ctx.stroke();

          // Đầu sao sáng
          ctx.fillStyle = `rgba(255, 255, 255, ${s.life})`;
          ctx.beginPath();
          ctx.arc(s.x, s.y, 2, 0, 2 * PI);
          ctx.fill();
        }
      }

      function drawHeart() {
        const cx = canvas.width / 2;
        const cy = canvas.height / 2;

        const beat = romanticHeartbeat(time);

        particles.forEach((p) => {
          const base = heartPoint(p.t);
          const depthFactor = Math.pow(p.depth, 1.4);
          const minAmp = 0.18;
          const maxAmp = 0.55;
          const amplitude = minAmp + (maxAmp - minAmp) * depthFactor;
          const pulse = 1 + beat * amplitude;
          const r = (1 - p.depth + p.jitterY) * 12 * pulse;
          const x = cx + (base.x + p.jitterX) * r;
          const y = cy - base.y * r;

          const brightness = 1 + beat * 0.5;
          const red = Math.min(255, 255 * brightness);
          const green = Math.min(140, 110 * brightness);
          const blue = Math.min(200, 170 * brightness);
          const dynamicAlpha = p.alpha + beat * 0.15;

          ctx.fillStyle = `rgba(${red}, ${green}, ${blue}, ${dynamicAlpha})`;
          ctx.beginPath();
          ctx.arc(x, y, p.size, 0, 2 * PI);
          ctx.fill();
        });
      }

      function animate() {
        time += 0.045;

        // Nền vũ trụ đậm
        ctx.fillStyle = "#000510";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        drawGalaxy();
        drawStars();
        drawPlanets();
        drawShootingStars();
        drawHeart();

        requestAnimationFrame(animate);
      }

      animate();
    </script>
  </body>
</html>
